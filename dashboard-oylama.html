<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
        integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="style.css">
    <title>Document</title>
</head>



    
<body>

    <div class="login-panel" id="loginPanel">
        <form id="loginForm">
            <label for="email">E-posta</label>
            <input type="email" id="email" placeholder="E-posta">
            <label for="password">Şifre</label>
            <input type="password" id="password" placeholder="Şifre">
            <button onclick="submit">Giriş Yap</button>
        </form>
    </div>
    <div class="register-panel" id="registerPanel">
        <form id="registerForm">
            <label for="first_name">İsim:</label>
            <input type="text" id="first_name" name="first_name" required>

            <label for="last_name">Soyad:</label>
            <input type="text" id="last_name" name="last_name" required>

            <label for="email">E-Posta:</label>
            <input type="email" id="email" name="email" required>

            <label for="password">Şifre:</label>
            <input type="password" id="password" name="password" required>

            <label for="userType">Kullanıcı Tipi:</label>
            <select id="userType" name="userType" required>
                <option value="user">User</option>
                <option value="admin">Admin</option>
            </select>

            <button type="submit">Kayıt Ol</button>
        </form>

        <div class="message" id="message"></div>
        <div class="error" id="error"></div>
    </div>

    <script>
        function toggleLoginPanel() {
            const loginPanel = document.getElementById('loginPanel');
            loginPanel.style.display = loginPanel.style.display === 'block' ? 'none' : 'block';
        }

        document.getElementById('loginForm').addEventListener('submit', function (event) {
            event.preventDefault(); // Formun varsayılan davranışını engelle

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            fetch('/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ email, password })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Kullanıcı bilgilerini localStorage'a kaydet
                        localStorage.setItem('loggedInUser', JSON.stringify(data.user));

                        // Dashboard'a yönlendir
                        window.location.href = 'dashboard.html';
                    } else {
                        // Giriş başarısız, hata mesajı göster
                        alert('Giriş başarısız.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        });

        document.addEventListener('click', function (event) {
            const loginPanel = document.getElementById('loginPanel');
            const loginButton = document.getElementById('login');

            if (!loginPanel.contains(event.target) && !loginButton.contains(event.target)) {
                // Login panelinin dışına tıklandıysa paneli gizle
                loginPanel.style.display = 'none';
            }
        });
        function toggleRegisterPanel() {
            const registerPanel = document.getElementById('registerPanel');
            registerPanel.style.display = registerPanel.style.display === 'block' ? 'none' : 'block';
        }

        document.getElementById('registerForm').addEventListener('submit', function (event) {
            event.preventDefault();

            const formData = new FormData(this);
            const jsonData = {};

            formData.forEach((value, key) => {
                jsonData[key] = value;
            });

            fetch('/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(jsonData)
            })
                .then(response => response.json())
                .then(data => {
                    const messageDiv = document.getElementById('message');
                    const errorDiv = document.getElementById('error');

                    if (data.success) {
                        messageDiv.textContent = 'Hesap başarıyla oluşturuldu!';
                        errorDiv.textContent = ''; // Hata mesajını temizle
                    }
                    else {
                        errorDiv.textContent = 'Kayıt başarısız oldu. Lütfen tekrar deneyin.';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('error').textContent = 'Bir hata oluştu. Lütfen daha sonra tekrar deneyin.';
                });
        });

        document.addEventListener('click', function (event) {
            const registerPanel = document.getElementById('registerPanel');
            const registerButton = document.getElementById('register');

            if (!registerPanel.contains(event.target) && !registerButton.contains(event.target)) {
                // Register panelinin dışına tıklandıysa paneli gizle
                registerPanel.style.display = 'none';
            }
        });

    </script>
    <header class="header">
        <a href="https://www.havelsan.com.tr" class="logo" target="_blank">
            <img src="images/havelsan.png" alt="logo" />
        </a>
        <nav class="navbar">
            <a href="/">Ana Sayfa</a>
            <a href="dashboard-program.html">Program</a>
            <a href="dashboard-oylama.html" class="active">Yarışmalar</a>
            <a href="dashboard-kullanicilar.html">Kullanıcılar</a>
        </nav>
        <div class="buttons">
            <button class="profile-btn" style="display:none;" onclick="toggleProfileMenu()">
                <i class="fas fa-user"></i>
            </button>
            <div class="profile-menu" id="profileMenu"></div>

            <!-- Login ve Register Butonları -->
            <div class="auth-buttons" id="authButtons">
                <button id="login" onclick="toggleLoginPanel()">Giriş Yap</button>
                <button id="register" onclick="toggleRegisterPanel()">Kayıt Ol</button>
            </div>
        </div>
    </header>
    <div class="sidebar">
        <h2>Sidebar Title</h2>
        <div class="sidebar-sections">
            <div class="sidebar-section">
                <input type="text" placeholder="Search Section 1..." class="search-box">
            </div>
            <div class="sidebar-section">
                <input type="text" placeholder="Search Section 2..." class="search-box">
            </div>
            <div class="sidebar-section">
                <input type="text" placeholder="Search Section 3..." class="search-box">
            </div>
            <div class="sidebar-section">
                <input type="text" placeholder="Search Section 4..." class="search-box">
            </div>
        </div>
    </div>
    <div class="activity-section">
        <div class="activity-blocks" id="activityBlocks">
            <button class="add-activity-btn" onclick="openModal()">
                <i class="fa-solid fa-circle-plus" style="font-size: 300%;"></i>
            </button>
            <!-- Modal structure -->
            <div id="activityModal" class="modal">
                <div class="modal-content">
                    <span class="close-btn" onclick="closeModal()">&times;</span>
                    <h2>Yeni Etkinlik Ekle</h2>
                    <form id="activityForm">
                        <label for="activityTitle">Başlık:</label>
                        <input type="text" id="activityTitle" name="activityTitle" required>
                        <label for="activityDescription">Açıklama:</label>
                        <textarea id="activityDescription" name="activityDescription" rows="4" required></textarea>
                        <button type="button" onclick="addActivity()">Ekle</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        function toggleProfileMenu() {
            var menu = document.getElementById('profileMenu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
            updateProfileMenu();
        }

        function updateProfileMenu() {
            var menu = document.getElementById('profileMenu');
            var user = JSON.parse(localStorage.getItem('loggedInUser'));

            if (user) {
                // User is logged in
                menu.innerHTML = `
                    <div class="profile-header">
                        <div class="profile-info">
                            <h3>${user.first_name} ${user.last_name} <span class="user-type">(${user.userType})</span></h3>
                            <p>${user.email}</p>
                        </div>
                    </div>
                    <button class="account-settings-link" onclick="window.location.href='profile-settings.html'"> Account Settings </button>
                    <button class="logout-btn" onclick="logout()"> Logout </button>
                `;
            } else {
                menu.innerHTML = '';
            }
        }

        function logout() {
            localStorage.removeItem('loggedInUser');
            window.location.href = 'dashboard.html';
        }

        document.addEventListener('DOMContentLoaded', function () {
            const user = JSON.parse(localStorage.getItem('loggedInUser'));
            const profileBtn = document.querySelector('.profile-btn');
            const authButtons = document.getElementById('authButtons');

            if (user) {
                // Kullanıcı oturum açmışsa profil butonunu göster
                profileBtn.style.display = 'block';
                authButtons.style.display = 'none';
            } else {
                // Kullanıcı oturum açmamışsa giriş ve kayıt butonlarını göster
                profileBtn.style.display = 'none';
                authButtons.style.display = 'flex';
            }
        });
    </script>
    <script>
        function openModal() {
            document.getElementById('activityModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('activityModal').style.display = 'none';
        }

        function addActivity() {
            const title = document.getElementById('activityTitle').value;
            const description = document.getElementById('activityDescription').value;

            if (title && description) {
                const timestamp = Date.now();
                const activityId = `${title.toLowerCase().replace(/\s+/g, '-')}-${timestamp}`;

                // Create the activity HTML file on the server
                fetch('/create-activity', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ id: activityId, title: title, description: description })
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Error creating activity HTML file.');
                        }
                        return response.text();
                    })
                    .then(message => {
                        console.log(message);
                        // Add the activity block to the page
                        const activitySection = document.querySelector('.activity-blocks');
                        const newActivity = document.createElement('div');
                        newActivity.className = 'activity-block';
                        newActivity.dataset.id = activityId;
                        newActivity.onclick = function () {
                            window.location.href = `activity-${activityId}.html`;
                        };

                        const activityTitle = document.createElement('h3');
                        activityTitle.textContent = title;

                        const activityDescription = document.createElement('p');
                        activityDescription.textContent = description;

                        newActivity.appendChild(activityTitle);
                        newActivity.appendChild(activityDescription);

                        const buttonsContainer = document.createElement('div');
                        buttonsContainer.className = 'buttons-container';

                        const deleteButton = document.createElement('button');
                        deleteButton.className = 'delete-btn';
                        deleteButton.textContent = 'X';
                        deleteButton.onclick = function (event) {
                            event.stopPropagation();
                            deleteActivityBlock(newActivity);
                        };

                        const editButton = document.createElement('button');
                        editButton.className = 'edit-btn';
                        editButton.textContent = 'Edit';
                        editButton.onclick = function (event) {
                            event.stopPropagation();
                            editActivityBlock(newActivity);
                        };

                        buttonsContainer.appendChild(editButton);
                        buttonsContainer.appendChild(deleteButton);
                        newActivity.appendChild(buttonsContainer);

                        activitySection.appendChild(newActivity);
                        saveActivities();
                        closeModal();
                        document.getElementById('activityForm').reset();
                    })
                    .catch(error => console.error('Error:', error));
            } else {
                alert('Başlık ve açıklama gereklidir.');
            }
        }

        function deleteActivityBlock(activity) {
            activity.remove();
            saveActivities();
        }

        function editActivityBlock(activity) {
            const title = prompt("Yeni başlığı girin:", activity.querySelector('h3').textContent);
            const description = prompt("Yeni açıklamayı girin:", activity.querySelector('p').textContent);

            if (title && description) {
                activity.querySelector('h3').textContent = title;
                activity.querySelector('p').textContent = description;
                saveActivities();
            } else {
                alert('Başlık ve açıklama gereklidir.');
            }
        }

        function saveActivities() {
            const activities = document.querySelectorAll('.activity-block');
            const activitiesArray = [];

            activities.forEach(activity => {
                const title = activity.querySelector('h3').textContent;
                const description = activity.querySelector('p').textContent;
                const id = activity.dataset.id;
                if (title && description && id) {
                    activitiesArray.push({ id, title, description });
                }
            });

            localStorage.setItem('activities', JSON.stringify(activitiesArray));
        }

        function loadActivities() {
            const savedActivities = JSON.parse(localStorage.getItem('activities')) || [];
            const activitySection = document.querySelector('.activity-blocks');

            savedActivities.forEach(activity => {
                const activityBlock = document.createElement('div');
                activityBlock.className = 'activity-block';
                activityBlock.dataset.id = activity.id; // Set the ID from saved data
                activityBlock.onclick = function () {
                    window.location.href = `activity-${activity.id}.html`; // Redirect to a unique page based on ID
                };

                const activityTitle = document.createElement('h3');
                activityTitle.textContent = activity.title;

                const activityDescription = document.createElement('p');
                activityDescription.textContent = activity.description;

                activityBlock.appendChild(activityTitle);
                activityBlock.appendChild(activityDescription);

                const buttonsContainer = document.createElement('div');
                buttonsContainer.className = 'buttons-container';

                const deleteButton = document.createElement('button');
                deleteButton.className = 'delete-btn';
                deleteButton.textContent = 'X';
                deleteButton.onclick = function (event) {
                    event.stopPropagation(); // Prevents event bubbling to the block's onclick handler
                    deleteActivityBlock(activityBlock);
                };

                const editButton = document.createElement('button');
                editButton.className = 'edit-btn';
                editButton.textContent = 'Edit';
                editButton.onclick = function (event) {
                    event.stopPropagation(); // Prevents event bubbling to the block's onclick handler
                    editActivityBlock(activityBlock);
                };

                buttonsContainer.appendChild(editButton);
                buttonsContainer.appendChild(deleteButton);
                activityBlock.appendChild(buttonsContainer);

                activitySection.appendChild(activityBlock);
            });
        }

        document.addEventListener('DOMContentLoaded', loadActivities);
    </script>
</body>

</html>
